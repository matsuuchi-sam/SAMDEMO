; ==============================================================================
; SAMDEMO - ESP32 PlatformIO 設定
; ==============================================================================
; 接続モードの切り替えは src/wifi_config.h の CONNECTION_MODE で行う
;
; 使い方:
;   pio run                                     ビルドのみ
;   pio run --target upload --upload-port COM4   書き込み
;   pio device monitor --port COM4 --baud 115200 USB モニタ
; ==============================================================================

[env:esp32dev]
platform  = espressif32
board     = esp32dev
framework = arduino

; --- シリアルモニタ設定 ---
monitor_speed = 115200
monitor_filters = esp32_exception_decoder  ; クラッシュ時のスタックトレース解読

; --- ライブラリ依存（3モード共通で入れておく）---
lib_deps =
    bblanchon/ArduinoJson @ ^7.0.0          ; JSON パース/生成
    links2004/WebSockets @ ^2.4.0           ; WebSocket クライアント (WiFi モード)
    ; BluetoothSerial は ESP32 Arduino フレームワーク内蔵（追加不要）

; --- ビルドフラグ ---
build_flags =
    -DCORE_DEBUG_LEVEL=3
    ; GR-SAKURA との UART ピン設定
    -DRXSAKURA_UART_RX_PIN=16
    -DRXSAKURA_UART_TX_PIN=17
    -DRXSAKURA_UART_BAUD=115200

; --- アップロード設定 ---
; upload_port = COM4         ; ← 環境に合わせて COM 番号を指定

; ==============================================================================
; USB モード用（開発中はこれを使う）
; platformio.ini では env 名を変えてモードを切り替えられる
; ==============================================================================
[env:usb_mode]
extends = env:esp32dev
build_flags =
    ${env:esp32dev.build_flags}
    -DCONNECTION_MODE=1        ; USB Serial モード

[env:wifi_mode]
extends = env:esp32dev
build_flags =
    ${env:esp32dev.build_flags}
    -DCONNECTION_MODE=2        ; WiFi WebSocket モード

[env:bt_mode]
extends = env:esp32dev
build_flags =
    ${env:esp32dev.build_flags}
    -DCONNECTION_MODE=3        ; Bluetooth SPP モード

; ==============================================================================
; OTA（無線アップデート）用 - Phase 5 以降
; ==============================================================================
[env:ota]
extends = env:wifi_mode
upload_protocol = espota
; upload_port = 192.168.x.x  ; ESP32 の IP アドレス
